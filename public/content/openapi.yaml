openapi: 3.0.3
info:
  title: Todo & Notes API
  description: |
    A comprehensive REST API for managing Todos and Notes, featuring user authentication, role-based access control, and advanced filtering options.
    
    ## Key Features
    - **Authentication**: JWT-based authentication.
    - **Uniform Responses**: All successful responses are wrapped in a `data` object.
    - **Pagination**: List endpoints support cursor-based or offset-based pagination.
    - **Filtering**: Advanced filtering on status, priority, and tags.
  version: 1.0.0
  contact:
    name: API Support
    email: support@xeocontext.com
    url: https://xeocontext.com/support
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: /api/v1
    description: Current Environment

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    Page:
      in: query
      name: page
      schema:
        type: integer
        default: 1
      description: Page number for pagination
    Limit:
      in: query
      name: limit
      schema:
        type: integer
        default: 20
        maximum: 100
      description: Number of items per page
    Id:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: standard UUID

  schemas:
    # --- Shared ---
    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              example: 400
            message:
              type: string
              example: Invalid request parameters
            details:
              type: array
              items:
                type: string

    PaginationMeta:
      type: object
      properties:
        currentPage:
          type: integer
        totalPages:
          type: integer
        totalItems:
          type: integer
        itemsPerPage:
          type: integer

    # --- User ---
    User:
      type: object
      required:
        - id
        - username
        - email
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
          format: email
        avatarUrl:
          type: string
          format: uri
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserInput:
      type: object
      required:
        - username
        - email
        - password
      properties:
        username:
          type: string
          minLength: 3
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
          format: password

    # --- Todo ---
    Todo:
      type: object
      required:
        - id
        - title
        - status
        - userId
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [pending, in_progress, completed, archived]
          default: pending
        priority:
          type: string
          enum: [low, medium, high, urgent]
          default: medium
        dueDate:
          type: string
          format: date
        tags:
          type: array
          items:
            type: string
        userId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TodoInput:
      type: object
      required:
        - title
      properties:
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [pending, in_progress, completed, archived]
        priority:
          type: string
          enum: [low, medium, high, urgent]
        dueDate:
          type: string
          format: date
        tags:
          type: array
          items:
            type: string

    # --- Note ---
    Note:
      type: object
      required:
        - id
        - title
        - content
        - userId
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        content:
          type: string
        isPublic:
          type: boolean
          default: false
        userId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    NoteInput:
      type: object
      required:
        - title
        - content
      properties:
        title:
          type: string
        content:
          type: string
        isPublic:
          type: boolean

security:
  - bearerAuth: []

tags:
  - name: Auth
    description: Authentication and Authorization
  - name: Users
    description: User management
  - name: Todos
    description: Task tracking and management
  - name: Notes
    description: Markdown notes and documentation

paths:
  # --- Auth ---
  /auth/login:
    post:
      tags: [Auth]
      summary: User Login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                      user:
                        $ref: '#/components/schemas/User'
  
  /auth/register:
    post:
      tags: [Auth]
      summary: Register a new user
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInput'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                     $ref: '#/components/schemas/User'

  # --- Users ---
  /users:
    get:
      tags: [Users]
      summary: List users
      description: Retrieve a list of users with pagination. Admin only.
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'

  /users/{id}:
    parameters:
      - $ref: '#/components/parameters/Id'
    get:
      tags: [Users]
      summary: Get user details
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
    patch:
      tags: [Users]
      summary: Update user details
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                avatarUrl:
                  type: string
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'

  # --- Todos ---
  /todos:
    get:
      tags: [Todos]
      summary: List todos
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, in_progress, completed, archived]
        - name: sort
          in: query
          schema:
            type: string
            enum: [createdAt, dueDate, priority]
      responses:
        '200':
          description: List of todos
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Todo'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
    post:
      tags: [Todos]
      summary: Create a new todo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TodoInput'
      responses:
        '201':
          description: Todo created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Todo'

  /todos/{id}:
    parameters:
      - $ref: '#/components/parameters/Id'
    get:
      tags: [Todos]
      summary: Get a specific todo
      responses:
        '200':
          description: Todo details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Todo'
    put:
      tags: [Todos]
      summary: Replace a todo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TodoInput'
      responses:
        '200':
          description: Todo updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Todo'
    delete:
      tags: [Todos]
      summary: Delete a todo
      responses:
        '204':
          description: Todo deleted

  # --- Notes ---
  /notes:
    get:
      tags: [Notes]
      summary: List notes
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: List of notes
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Note'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
    post:
      tags: [Notes]
      summary: Create a new note
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NoteInput'
      responses:
        '201':
          description: Note created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Note'

  /notes/{id}:
    parameters:
      - $ref: '#/components/parameters/Id'
    get:
      tags: [Notes]
      summary: Get a specific note
      responses:
        '200':
          description: Note details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Note'
    patch:
      tags: [Notes]
      summary: Update a note partially
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                   type: string
                content:
                   type: string
                isPublic:
                   type: boolean
      responses:
        '200':
          description: Note updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Note'
    delete:
      tags: [Notes]
      summary: Delete a note
      responses:
        '204':
          description: Note deleted
